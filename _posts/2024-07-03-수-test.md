# day25,72_Pandas

- **Docs**
    - [https://pandas.pydata.org/docs/getting_started/index.html](https://pandas.pydata.org/docs/getting_started/index.html)
    - [https://pandas.pydata.org/docs/reference/index.html](https://pandas.pydata.org/docs/reference/index.html)

- **Pandas 라이브러리가 필요한 이유**
    - csv 파일 - 표 형태 데이터 작업 → 복잡, 귀찮
        
        ```python
        # temp 컬럼만 리스트로 가져오기 _ csv
        
        import csv
        
        with open("weather_data.csv") as data_file:
            data = csv.reader(data_file)
            temperatures = []
            for row in data:
                if row[1] != "temp":
                    temperatures.append(int(row[1]))
            print(temperatures)
        ```
        
        ![Untitled](day25,72_Pandas%20ffcf50fab5174f66b98b341c47584b61/Untitled.png)
        
        - cf. CSV(Comma Separated Values): 콤마로 분류된 데이터 형태
            
            ```python
            with open("weather_data.csv") as data_file:
                data = data_file.readlines()
                print(data)
            ```
            
            ![Untitled](day25,72_Pandas%20ffcf50fab5174f66b98b341c47584b61/Untitled%201.png)
            
    
    ---
    
    - pandas 라이브러리 - 표 형태 데이터 작업 → 간편, 용이
        
        ```python
        # temp 컬럼만 리스트로 가져오기 _ pandas   
        
        import pandas
        
        data = pandas.read_csv("weather_data.csv")
        print(data["temp"])
        ```
        
        ![Untitled](day25,72_Pandas%20ffcf50fab5174f66b98b341c47584b61/Untitled%202.png)
        

- **Pandas Data Type**
    - **DataFrame**
        
        ![Untitled](day25,72_Pandas%20ffcf50fab5174f66b98b341c47584b61/Untitled%203.png)
        
        ```python
        import pandas
        
        data = pandas.read_csv("weather_data.csv")
        print(type(data))
        
        <class 'pandas.core.frame.DataFrame'>
        ```
        
    - **Series**
        
        ![Untitled](day25,72_Pandas%20ffcf50fab5174f66b98b341c47584b61/0af7933d-1073-4e87-8e73-c6b947bd3af7.png)
        
        ```python
        import pandas
        
        data = pandas.read_csv("weather_data.csv")
        print(type(data["temp"]))
        
        <class 'pandas.core.series.Series'>
        ```
        

- 연습
    
    ![Untitled](day25,72_Pandas%20ffcf50fab5174f66b98b341c47584b61/Untitled%204.png)
    
    ```python
    import pandas
    
    data = pandas.read_csv("weather_data.csv")
    ```
    
    | 딕셔너리로 출력  | data_dict = data.to_dict() |
    | --- | --- |
    | 리스트로 출력  | temp_list = data["temp"].to_list() |
    | 칼럼 평균값  | average_temp = sum(temp_list) / len(temp_list)
    data["temp"].mean() |
    | 칼럼 최댓값  | data["temp"].max() |
    | Get Data in Columns | data["condition"]
    data.condition |
    | Get Data in Rows | # 컬럼이 월요일인 행을 출력  
    data[data.day == "Monday"]
    # 가장 높은 온도의 행을 출력
    data[data.temp == data.temp.max()] |
    | Create a dataframe | data_dict = {
        "students": ["Amy", "James", "Angela"],
        "scores": [76, 56, 65]
    }
    data = pandas.DataFrame(data_dict) |
    | csv 파일로 저장    | data.to_csv("new_data.csv") |

- 실습1: 센트럴 파크 다람쥐 데이터 분석
    
    ![Untitled](day25,72_Pandas%20ffcf50fab5174f66b98b341c47584b61/Untitled%205.png)
    
    - 센트럴 파크 다람쥐 데이터 csv 파일에서 → pandas 이용하여, 색깔별  다람쥐 개체수 테이블 뽑아내기
    - 만들어낸  다람쥐 색깔별 개체수 테이블 →  quirrel_count.csv 파일 생성
    - 결과
        
        ```python
        #(sol1: 강의 풀이)
        import pandas
        data = pandas.read_csv("2018_Central_Park_Squirrel_Census_-_Squirrel_Data_20240629.csv")
        grey_squirrels_count = len(data[data["Primary Fur Color"] == "Gray"])
        red_squirrels_count = len(data[data["Primary Fur Color"] == "Cinnamon"])
        black_squirrels_count = len(data[data["Primary Fur Color"] == "Black"])
        data_dict = {
            "Fur Color": ["Gray", "Cinnamon", "Black"],
            "Count": [grey_squirrels_count, red_squirrels_count, black_squirrels_count]
        }
        df = pandas.DataFrame(data_dict)
        df.to_csv("squirrel_count.csv")
        
        #(sol2: 마이 풀이) 
        import pandas
        data = pandas.read_csv("2018_Central_Park_Squirrel_Census_-_Squirrel_Data_20240629.csv")
        color_count = data["Primary Fur Color"].value_counts()
        color_count.to_csv("squirrel_count_by_colors")
        ```
        

- 실습2: 미국 주 게임
    - 

- 프로젝트1: 판다스(Pandas)로 졸업생의 전공별 졸업 후 급여를 분석을 통한 데이터 탐색 배우기
    - 대학 학위는 *매우* 비쌉니다. 그러나 학위가 돈을 갚아주나요? 
    철학이나 국제 관계를 전공으로 선택하면 부모님을 걱정하게 만들죠, 그런데 부모님의 우려가 데이터로 증명이 될까요?
    - PayScale Inc.는 학사 학위만 있는 120만 명의 미국인을 대상으로 1년 동안 설문조사를 실시했습니다.
    - 이 데이터를 자세히 살펴보며 판다스를 사용하여 다음 질문에 답을 해보겠습니다.
        - 초봉이 가장 높은 학위는 무엇일까?
        - 대학 졸업 후 소득이 가장 낮은 전공은 무엇일까?
        - 어떤 학위가 가장 높은 소득 잠재력을 가지고 있을까?
        - 소득 관점에서 위험성이 가장 낮은 대학 전공은 무엇일까?
        - 경영이나 STEM(과학, 기술, 공학, 수학), HASS(인문, 예술, 사회 과학) 학위가 평균적으로 더 많은 소득을 벌까?

- 오늘 배울 것은 아래와 같습니다.
    - 판다스 데이터프레임(DataFrame)을 탐색하는 방법
    - NaN(Not a Number, 숫자 아님) 값을 감지하고 데이터를 정리하는 방법
    - 특정 열, 행 및 개별 셀을 선택하는 방법
    - 데이터를 정렬하는 방법
    - 범주별로 데이터를 그룹화하는 방법

# **판다스를 이용한 예비 데이터 탐색 및 데이터 정리**

> 이것은 어떤 데이터 과학 프로젝트에서도 마찬가지로 거치는 첫 번째 단계: 작업 중인 데이터가 무엇인지 이해하기 위해 자세히 살펴봐야 한다.
> 
- **행과 열 확인**
    
    
    | .head() | 상위 5개  |
    | --- | --- |
    | .tail() | 하위 5개  |
    | .shape | 행과 열의 개수   |
    | .columns | 열의 이름  |
    - 데이터프레임에는 몇 개의 행, 몇 개의 열이 있나요?
        - `df.head()`: 상위 5개 행 나열
        - `df.shape`: 행과 열의 개수
            
            ![https://img-c.udemycdn.com/redactor/raw/2020-09-22_11-25-16-cd50d633f77245b7763d832704e7bf05.png](https://img-c.udemycdn.com/redactor/raw/2020-09-22_11-25-16-cd50d633f77245b7763d832704e7bf05.png)
            
    - 열의 레이블은 무엇인가요? 열에 이름이 있나요?
        - `df.columns`: 열 이름 나열
- **결측값 및 정크 데이터**
    
    분석을 진행하기 전에 데이터프레임에 누락된 데이터 또는 정크 데이터는 없는지 확인해야 합니다. 그렇게 하여 나중에 일어날 수 있는 문제를 피할 수 있거든요. 
    이 경우, 데이터프레임에 NaN(Not a Number, 숫자 아님) 값을 찾아보겠습니다. NaN 값은 빈 셀 또는 숫자 대신 문자열을 포함하는 셀입니다. 
    
    | .findna() | NaN(not a number, 숫자 아님) 값 찾기  |
    | --- | --- |
    | .isna() | 결측값 확인  |
    | .dropna() | 결측값 제거  |
    - 데이터프레임에 누락된 값이 있나요? 데이터프레임에 잘못된 데이터가 포함되어 있지는 않나요?
        - `df.isna()` : 결측값 확인
        - `df.dropna()`: 결측값 제거
        - `df.tail()` : 하위 5개 행 나열
            
            ![https://img-c.udemycdn.com/redactor/raw/2020-09-22_11-35-12-4320cf381d16ea74700b9f103ddd6842.png](https://img-c.udemycdn.com/redactor/raw/2020-09-22_11-35-12-4320cf381d16ea74700b9f103ddd6842.png)
            

# **데이터프레임에 있는 열 및 개별 셀에 접근하기**

| df['column name']
df[['column name 1', 'column name 2', 'column name 3']] | [] 표기를 이용하여 데이터프레임의 전체 열에 접근 |
| --- | --- |
| df['column name'][index]
df['column name'].loc[index] | 데이터프레임에 있는 개별 셀에 접근 |
| .max() | 최댓값 |
| .min() | 최솟값 |
| .idxmax() | 최댓값 위치  |
| .idxmin() | 최솟값 위치  |
- **초봉이 가장 높은 대학 전공 찾기?**
    - `clean_df['Starting Median Salary']`
        
        ![https://img-c.udemycdn.com/redactor/raw/2020-09-22_11-43-02-a2d17fe32f141cfc42f3b7c60d7b646c.png](https://img-c.udemycdn.com/redactor/raw/2020-09-22_11-43-02-a2d17fe32f141cfc42f3b7c60d7b646c.png)
        
    - `clean_df['Starting Median Salary'].max()` : 가장 큰 행의 값
    - `clean_df['Starting Median Salary'].idxmax()` : 가장 큰 값을 가진 행에 대한 인덱스
    - `clean_df['Undergraduate Major'][43]`
    - `clean_df['Undergraduate Major'].loc[43]` : 해당 인덱스 위치의 속성 값
        
        ![https://img-c.udemycdn.com/redactor/raw/2020-09-22_11-56-10-07043fb3a8bb6a9f4fd3e5d17f4319d5.png](https://img-c.udemycdn.com/redactor/raw/2020-09-22_11-56-10-07043fb3a8bb6a9f4fd3e5d17f4319d5.png)
        
    - `clean_df.loc[43]` : 특정 열을 지정하지 않으면 .loc 속성을 사용하여 전체 행을 검색
        
        ![https://img-c.udemycdn.com/redactor/raw/2020-09-22_11-58-08-1c59109dc860ad3b4571bc492a16445b.png](https://img-c.udemycdn.com/redactor/raw/2020-09-22_11-58-08-1c59109dc860ad3b4571bc492a16445b.png)
        
- **초봉이 가장 낮은 대학 전공은 무엇이며 졸업 후 졸업생은 얼마를 벌까?**
- **중간 경력 봉급이 가장 낮은 대학 전공은 무엇이며 이 학위로 얼마를 벌 수 있을까?**
- **중간 경력 봉급이 가장 높은 대학 전공은? 이 전공 졸업생들은 얼마를 벌까? (중간 경력은 10년 이상의 경력으로 정의합니다.)**

# **값 분류 및 열 추가하기: 잠재력이 가장 큰 전공 대 위험도가 가장 낮은 전공**

| .subtract() | 컬럼 간의 빼기   |
| --- | --- |
| .sort_values() | 데이터프레임 정렬, 분류 |
| .insert() | 새로운 열 추가 |
- **위험도가 가장 낮은 전공?**
저위험 전공은 최저 급여와 최고 급여의 차이가 작은 학위입니다. 
다른 말로, 여러분 전공에서 10번째 백분위수와 90번째 백분위수 소득의 차이가 작으면, 여러분이 졸업 후 받게 될 급여에 대해 더 확신할 수 있겠죠.
10번째 백분위수와 90번째 백분위수 소득 간의 차이를 어떻게 계산할까요? 
판다스를 사용하면 전체 열에 대해 간단한 산술 연산을 수행할 수 있으므로 두 열의 차이를 취하기만 하면 됩니다.
    - `spread_col = clean_df['Mid-Career 90th Percentile Salary'].subtract(clean_df['Mid-Career 10th Percentile Salary'])`: 빼기
        - `spread_col = clean_df['Mid-Career 90th Percentile Salary'] - clean_df['Mid-Career 10th Percentile Salary']`
    - `clean_df.insert(1, 'Spread', spread_col)` : 기존 데이터프레임에 컬럼 추가
        
        ![https://img-c.udemycdn.com/redactor/raw/2020-09-22_14-10-35-1520a94db77897101844ff463324112a.png](https://img-c.udemycdn.com/redactor/raw/2020-09-22_14-10-35-1520a94db77897101844ff463324112a.png)
        
    - `low_risk = clean_df.sort_values('Spread')` : 오름차순 정렬
        - 파이썬 노트북에서 키보드의 shift + tab 키를 사용하여 문서를 바로 불러올 수도 있다.
        - [https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_values.html](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_values.html)
    - `low_risk[['Undergraduate Major', 'Spread']].head()`
        
        ![Untitled](day25,72_Pandas%20ffcf50fab5174f66b98b341c47584b61/Untitled%206.png)
        
- **.sort_values() 메소드를 사용하여 잠재력이 가장 높은 학위를 찾을 수 있을까요? 90번째 백분위수에서 가장 높은 값을 가진 상위 5 학위를 찾아 보세요.**
- **또한 급여에서 가장 큰 분포를 보이는 학위를 찾으십시오. 졸업 후 고소득자와 저소득자 사이 소득 차이가 가장 큰 전공은 무엇일까요?**

# **판다스를 이용한 그룹화 및 피벗**

> 특정 범주에 있는 행의 합을 구하고자 할 때가 자주 있죠.
> 

| .groupby() | 특정 범주에 속하는 항목을 그룹화하여 엑셀 스타일 피벗 테이블을 생성 |
| --- | --- |
- **평균 봉급이 가장 높은 학위 범주는 어디인가요?** STEM, 경영, HASS(인문, 예술, 사회 과학) 중 어디인가요?
    - `clean_df.groupby('Group').count()`
        
        ![https://img-c.udemycdn.com/redactor/raw/2020-09-22_14-45-49-042eeb486294d63c68c3334bc7b062da.png](https://img-c.udemycdn.com/redactor/raw/2020-09-22_14-45-49-042eeb486294d63c68c3334bc7b062da.png)
        
    - `lean_df.groupby('Group').mean()`
        
        ![https://img-c.udemycdn.com/redactor/raw/2020-09-22_14-47-11-d18a831086743cc64e2779b4b791dcd7.png](https://img-c.udemycdn.com/redactor/raw/2020-09-22_14-47-11-d18a831086743cc64e2779b4b791dcd7.png)
        
- **출력에서 숫자 형식**
    - `pd.options.display.float_format = '{:,.2f}'.format`
        
        ![https://img-c.udemycdn.com/redactor/raw/2020-09-22_14-49-50-81fee388ca0de81b4f791e6481392d76.png](https://img-c.udemycdn.com/redactor/raw/2020-09-22_14-49-50-81fee388ca0de81b4f791e6481392d76.png)
        

**추가 점수 획득:**

이 강의에서 사용한 페이스케일 데이터셋은 2008년 자료이며, 이전 10년에 대한 것입니다. 
당시 재정학이 학위 후 수입에서 어떻게 이런 높은 순위를 차지했을까요. 
하지만 우리 모두는 그 해에 막대한 재정적 위기가 있었다는 것을 알고 있죠. 아마도 상황은 그때와 같지 않을 거에요. 
이전 강의(예를 들어 45일차)에서 웹 스크래핑에 대해 배운 것을 사용하여 아래 코멘트에 있는 [페이스케일웹사이트](https://www.payscale.com/college-salary-report/majors-that-pay-you-back/bachelors)에서 변경된 정보를 공유해줄 수 있나요?